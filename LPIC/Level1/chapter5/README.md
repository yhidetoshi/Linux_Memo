####    Chapter5 デバイスとLinuxファイルシステム
- **内容**
  - **パーティションとファイルシステムの作成**
  - **ファイルシステムの管理**
  - **ファイルシステムのマウントとアンマウント**
  - **ディスククォータの管理**
  - **ファイルの配置と検索**


- **IDE**
  - ひと昔前まで、一般のPCやサーバなどにおいて主流の形式だったもの
  -　**プライマリー**
    -　**マスター**
  - **セカンダリ**
    - **スレーブ** 

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Linux_Memo/ide-image.jpg)


- ハードディスク
  - **SATA**(Sirial ATA)
    - ほとんどのPCで標準的に搭載されている
  - **SAS**(Sirial Attached SCSI)
    - SATAよりも高速で信頼性も高いく、高価
  - **SCSI**
    - SCSI
      - ハードディスクやDVDドライブ、テープドライブなど、様々な周辺機器を接続するための規格
      - 高価で一般的に高速。拡張性も高い

**主なデバイスファイル**

|デバイスファイル|説明         |
|:-----------|:------------|
|/dev/sda|1番目のHD|
|/dev/sdb|2番目のHD|
|/dev/sdc|3番目のHD|
|/dev/sdd|4番目のHD|
|/dev/sr0|1番目のCD/DVDドライブ|
|/dev/st0|1番目のテープドライブ|


- LVM
  - 物理的な記憶デバイスの領域(物理ボリューム)をまとめ、論理的な一つの大きな記憶デバイス(ボリュームグループ)を作り、それを切り出して仮想的なパーティション(論理ボリューム)を作ることができる 
  - PV (Physical Volume)LVMにおける物理ボリューム
  - VG (Volume Group)
  - LV (Logical Volume)

- LVMの特徴
  - 論理ボリュームを動的にリサイズできる
  - ボリュームグループは、物理ボリュームを集めて構成された仮想的な領域
  - スナップショットが取れる
  - ボリュームグループに後から物理ボリュームを加えることができる

- 論理ボリュームを作成する手順
1. 物理ボリューム(PV)の作成: `pvcreate`
2. ボリュームグループ(VG)の作成: `vgcreate`
3. 論理ボリューム(LV)の作成; `lvcreate`

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Linux_Memo/Volume.png)


- パーティション
  - **基本パーティション**
    - ディスクには最大4個の基本パーティションを作成することができる
    - /dev/sda1〜4
  - **拡張パーティション**
    - 基本パーティションの1つを拡張パーティションにすることができる
    - 拡張パーティションの中にファイルシステムではなく、論理パーティションが格納される
  - **論理パーティション**
    - 拡張パーティション内に作成されたパーティションのこと
    - 論理パーティションのデバイスファイル名は、作成済み基本パーティションの数にかかわらず、/dev/sda5以降になる
    
![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Linux_Memo/disk-partition.png)


**[rootファイルシステム]**

![Alt Text](https://github.com/yhidetoshi/Pictures/raw/master/Linux_Memo/filesystem-root.png)


- **fdiskコマンド**
  - パーティションの作成、削除、変更、情報表示などを行う
  - (ex)`#fdisk -l /dev/sda`
  - `l`: パーティションタイプ一覧を表示
  - `n`: パーティションを作成
  - `d`: パーティションを削除
  - `p`: パーティションテーブルを表示する
  - `t`: パーティションてイプを変更する
  - などなど

- **gdiskコマンド**
  - 従来のMBR(マスターブートレコード)の他にGPTがある
  - GPTを扱うためにのコマンド

- **parted**
  - MBRにもGPTにも対応したパーティション操作 
  
- **ファイルシステム**
  - **セクタ**
    - ディスク上の区画
  - **ブロック** 
    - ファイルシステムから見た場合
  
**[ファイルシステムの種類]**

|デバイスファイル|説明         |
|:-----------|:------------|
|ext2|Linuxの標準ファイルシステム|
|ext3|ext2ジャーナリング機能を加えたファイルシステム|
|ext4|ext3を機能拡張したファイルシステム|
|JFS|IBM社が開発したジャーナリングシステム|
|iso9660|CD-ROMのファイルシステム|
|vfat|SDカードや古いwindowsで使われるファイルシステム|

- **mkfsコマンド**
  - パーティション上にファイルシステムを作成する
  - `#mkfs -t ext4 /dev/sdb1`

- **mkfs2コマンド**
  - ext2,ext3及び、ext4ファイルシステムを作成するにはmkefsコマンドも利用できる

- **mkswapコマンド**
  - パーティション上にスワップ領域を作成
  - 通常はスワップ領域として、独立したパーティションを割り当てる
  - システムには最低１つのスワップ領域が必要
  - `#mkswap /dev/sda6`

- **dfコマンド**
  - ファイルシステムの空き容量を確認できる

- **duコマンド**
  - ファイルやディレクトリが占めている容量を表示する

- **fsckコマンド**
  - ディスクのチェックを行い、必要であれば修復を試みる

- **e2fsckコマンド**
  - ext2, ext3及び、ext4ファイルシステムのチェックと修復

- **XFS**
  - 多くのLinuxディストリビューションではext4が標準のファイルシステムになっている
  - Redhat7,CentOS7ではXFSが標準のファイルシステムになっている

- **/etc/fstab**
  - ファイルシステムの情報が記述されている
  - `/dev/sda1 /boot ext3 defaults 1 2`
    - デバイスファイル名
      - デバイスファイル名、もしくはラベル名、またはUUIDを指定
    - マウントポイント
    - ファイルシステムの種類
    - マウントオプション
      - マウントする際に必要となるオプションを指定する、複数のオプションを指定する場合は「,」で区切る 
    - dumpフラグ
      - 1であれば、dumpコマンドによるバックアップ対象となる
      - 通常、ext2/ext3ファイルシステムは1を、その他のファイルシステムは0を指定
    - ブート起動時にfsckがチェックする順序
      - Linuxが起動する時にfsckがチェックする順序を0,1,2で指定できる
      - 1,2,・・・の順にチェックされ、0を指定するとチェックされない
      

- **mountコマンド**
  - オプション
    - `-a` : /etc/fstabに記述されているファイルシステムを全てマウントする
    - `-t` : ファイルシステムの種類を指定する

- **umountコマンド**
  - オプション
    - `-a` : /etc/mtabに記述されているファイルシステムを全てアンマウントする
    - `-t` : 指定した種類のファイルシステムだけをアンマウントする


- **クォータの制限**
  - **ユーザごとのハードリミット**
    - 1ユーザが利用できる最大のディスク容量がハードリミット
    - ハードリミットに到達すると、それ以上ファイルが書き込めなくなる
  - **ユーザごとのソフトリミット**
    - 容量制限の警告を発するタイミングがソフトリミット
    - ソフトリミットに達するとユーザに対して警告が発せられるが書き込める
  - **グループごとのハードリミット**
  - **グループごとのソフトリミット**
  - **猶予期間**
    - ソフトリミットを超えた場合、猶予期間に入る。猶予期間が経過すると、ソフトリミットがハードリミットとみなされ、それ以上、ファイルに書き込みができなくなる。
    - 解除するには、リミットよりファイルを削除する。
    - デフォルトでは猶予期間は7日間(変更可能)
 

- **quotaコマンド**
  - quotacheckコマンドでクォータデータベースを初期化する
    - `quotackeck /home`
  - quotanコマンドでクォータを有効にする
    - quotaon -auv 
  - edquotaコマンドでユーザごとのクォータを設定する  


|デバイスファイル|説明     |
|:-----------|:------------|
|bin|基本的なコマンドが配置|
|sbin|システム管理者に必須のコマンドが配置|
|/etc|システムやアプリケーションの設定情報|
|/dev|ハードディスクやCD-ROMなどのデバイスファイルが配置|
|/lib|共有ライブラリやカーネルモジュールが配置|
|/media|DVD-ROMなどリムーバブルメディアのマウントポイントが配置|
|/mnt|一時的にマウントするファイルシステムのマウントポイントが配置|
|/opt|パッケージ管理の仕組みを使ってプログラムがインストールされる|
|/proc|カーネル内部の情報にアクセスするための仮想的なファイルシステム|
|/root|rootのホームディレクトリ|
|/boot|起動に必要な設定やカーネルイメージが配置|
|/var/sppl|印刷待ちのデータや予約されたジョブなどが処理待ちのデータが配置|



- **findコマンド**
  - `$find /root -name "*.txt"` 
  - find [検索ディレクトリ] [検索式]
  - /dataディレクトリ以下から過去1日以内に更新されたファイルを検索
    - `$ find /data -type f -mtime -1`
  - /usr/binディレクトリ以下からSUIDが設定されたファイルを検索する 
    - `# find /usr/bin -type f -perm -u+s`
  - /tmpディレクトリ以下から所有者がstudentであるファイルやディレクトリを検索
    - `# find /tmp -user student`
  - カレントディレクトリ以下から30日を超える日数の間、アクセスされていないファイルを検索して削除
    - `find -atime +30 -exec rm{} ¥;` 
  
- **locateコマンド**
  - locate [検索パターン]
  - `$ locate "*h"`
  - locateコマンドはあらかじめ作成されたファイル名データベースに基づいて検索するので、findコマンドよりも高速に動作する。

- **updatedbコマンド**
  - update [オプション]
  - `-e`
    - データベースに取り込まないパスを指定する
  - `# updatedb -e /home`
  - `/etc/updatedb.conf`

- **which**
  - `which [コマンド名]`
    - コマンドを探し出して絶対パスを表示 
    
- **whereisコマンド**
  - 指定されたコマンドのバイナリファイル、ソースコード、マニュアルファイルが置かれている場所を検索
  - `whereis [オプション] コマンド`
  - `-b` : バイナリファイルのみを検索
  - `-m` : マニュアルファイルのみを検索
  - `-s` : ソースファイルのみを検索
  - `$ whereis ifconfig`

- **typeコマンド**
  - 指定したコマンドが通常の実行ファイルなのか、シェルの組み込みコマンドなのか、エイリアスなのかという情報を表示する
