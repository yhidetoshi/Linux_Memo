##Chapter2 Linuxのインストールとパッケージ管理
- **内容**
  - **ハードウェアディスクのレイアウト設計**
  - **ブートマネージャのインストール**
  - **共有ライブラリ管理**
  - **Debianパッケージの管理**
  - **RPMパッケージの管理**



####Linuxインストールに必要なパーティション

- スワップ領域
  - メモリサイズと同程度〜2倍程度のサイズを割り当てる
- 用途が異なるディレクトリは別のパーティションを配置するようにする

####ブートマネージャのインストール

- ブートマネージャー
  - **MBR(マスターブートレコード)**から起動プログラムを読み込む
    - 第一段階のブローダ
    - 第二段階のブローダ
      - MBRのサイズが小さいために2段階に分けている
  - 代表的なブローダ
    - **GRUB**
    - **LILO**

- 第一段階のブートローダは通常MBR(マスターブートレコード)に格納される

- **GRUB**
  - 多機能ブートローダ
    - 多数のファイルシステムを認識可能
    - シェル機能を搭載し、コマンドによる高度な管理が可能
    - `grub-install`コマンド

**GRUB Legacyの場合**

`grub> kernel カーネルイメージ[option]`

**GRUB2の場合**

`grub > linux カーネルイメージ[option]`

|起動オプション|説明         
|:-----------|:------------|
|init=パス   |initの代わりに指定コマンドを実行|
|root=デバイス名|ルートパーティションを設定|
|数字(0-6)|指定したランレベルで起動|
|quiet|起動中のカーネルから情報出力を抑制する|


[/dev/sdaのMBR領域にGRUBをインストール]
```
# grub-install /dev/sda
```

- GRUBの設定ファイル
  - `/boot/grub/menu.lst` 

`# cat /boot/grub/menu.lst`
```
#boot=/dev/sda
default=0
timeout=0
hiddenmenu
title CentOS (2.6.32-431.3.1.el6.x86_64)
	root (hd0,0)
	kernel /boot/vmlinuz-2.6.32-431.3.1.el6.x86_64 ro root=UUID=1d798f26-8ace-413f-9530-2d1d1d4fdbb5 rd_NO_LUKS  KEYBOARDTYPE=pc KEYTABLE=us LANG=en_US.UTF-8 clocksource_failover=acpi_pm rd_NO_MD SYSFONT=latarcyrheb-sun16 crashkernel=auto rd_NO_LVM rd_NO_DM
	initrd /boot/initramfs-2.6.32-431.3.1.el6.x86_64.img
```
**GRUM Legacy(GRUB1)の場合**

|表記|説明         
|:-----------|:------------|
|root(hd0,0)|1番目のディスクの1番目のパーティション|
|root(hd0,1)|1番目のディスクの2番目のパーティション|
|root(hd1,1)|2番目のディスクの2番目のパーティション|

- GRUB Legacyの設定ファイル
  - `/boot/grub/grub.conf`
  - `/boot/grub/menu.lst`

- grub2
  - 設定ファイル：`/boot/grub/grub.cfg`
  - 直接設定ファイルを編集することはない
  - `/etc/default/grub`ファイル及び`/etc/grub.d`ディレクトリ内のファイルに記述
  - `# grub-mkconfig`で設定内容を`/boot/grub/grub.cfg`ファイルに反映させる

**GRUM Legacy(GRUB2)の場合**

|表記|説明         
|:-----------|:------------|
|root(hd0,1)|1番目のディスクの1番目のパーティション|
|root(hd0,2)|1番目のディスクの2番目のパーティション|
|root(hd1,3)|2番目のディスクの3番目のパーティション|


- **LILO**
  - Intelアーキテクチャ用のブローダ
  -　**ブローダ**
    - BIOSによって実行され、Linuxカーネルや他のOSをメモリ上に読み混む役割
  - **マップインストーラ**
    - ブートセクタを更新
    - マップファイルを作する
    - `/sbin/lilo`
  - **マップファイル**
    - ディスク上の物理的なカーネルの位置を記録したファイル 
  - **LILO設定ファイル**
    - `/etc/lilo.conf`

- 共有ライブラリの確認
  - 実行ファイルが必要としている共有ライブラリは`ldd`コマンドで調べられる
  - `/lib`
  - `/usr/lib`
  - `/etc/ld.so.conf`ファイルに記述する
  - 実際にはバイナリのキャッシュファイルが参照される
    - `/etc/ld.so.cache`
  - `ldconfig`コマンドは`/etc/ld.so.conf`ファイルに基づいて、`/etc/ld.so.cache`(プログラム実行時に共有ライブラリの場所を検索するためにしようされる)
  - `ldconfig` 共有ライブラリのキャッシュファイル`/etc/ld.so.cache`を更新する
  - その他のディレクトリも検索対象に加えたい場合は`環境変数 LD_LIBRARY_PATH`に記述する
  - `ldd /bin/bash` : 「/bin/bash」を実行する時に必要となる共有ライブラリを調べる
  

**ディレクトリのまとめ**

|ディレクトリ|分割適否  |説明         |
|:-----------|:------------|:------------|
|/home|◯|一般ユーザのホームディレクトリ(書き込みが頻繁に発生)|
|/usr|◯|起動には不要なプログラムを格納(読み込みが頻繁に発生)|
|/var|◯|ログファイルやメールなど可変ファイル群を格納(書き込みが頻繁に格納)|
|/boot|△|Linuxカーネルなど起動に必須のファイルを格納|
|/tmp|△|一時的なファイルを格納|
|/bin|×|一般ユーザのコマンドを格納|
|/sbin|×|管理者用のコマンドを格納|
|/etc|×|システムの設定ファイルを格納|
|/lib|×|共有ライブラリを格納|
|/dev|×|デバイスファイルを格納|

- Linuxをインストールする際の必要最低限のパーティション
  - スワップ領域
  - ルートパーティション

#### パッケージ管理

- パッケージ
  - 「実行プログラム」、「設定ファイル」、「ドキュメント」
  -　パッケージ管理システムで管理が容易
  -　Debian形式
    - dpkgコマンド、dselectコマンド、APTツール
　-　RPM形式
　  - rpmコマンド　
 
- **apt-getコマンド**
  - パッケージ管理
    - `/etc/apt/sources.list`
  - `apt-get dist-upgrade` : 既存の構成と矛盾することになるパッケージはアップグレードしない

- **apt-cacheコマンド**
　- パッケージ情報を照会、検索することができるコマンド
　- 照会、検索する対象のパッケージはインストールされていなくても良い

- **aptitudeコマンド**
　- `apt-getコマンド`よりも高度な機能を持ったコマンド
　- とりわけ、正規表現を使った検索機能が優れている



**apt-getコマンド**

|サブコマンド|説明         
|:-----------|:------------|
|install <package>|パッケージのインストール、アップグレード|
|remove <package>|パッケージのアンインストール|
|upgrade|インストール済みの全パッケージのアップグレード|
|dist-upgrade|ディストリビューションを最新版にアップグレード|
|update|パッケージのデータベースを最新版に更新|
|clean|過去に取得したパッケージファイルを削除|

- Debian形式のパッケージ管理ツール
  - dpkgツール
    - `/etc/dpkg/dpkg.cfg` : 設定ファイル
  - APT(Advanced Package Tool)ツール
    - APTツールはdpkgツールを拡張したツール群、依存関係を調整しながらパッケージ管理
   　 - `apt-get`
   　 - `aptitude`
   　 - `/etc/apt/sources.list` : ネットワーク経由で最新のパッケージを取得する際のリポジトリ設定

**apt-cacheサブコマンド**

|サブコマンド|説明         
|:-----------|:------------|
|search キーワード|キーワードを含むパッケージを検索|
|show パッケージ名|指定したパッケージ情報を表示|
|showpkg パッケージ名|指定したパッケージの被依存関係を含めた情報の表示|
|depends パッケージ名|指定したパッケージが依存しているパッケージの一覧表示|

**dpkg [option] アクション**

|オプション|説明|         
|:-----------|:------------|
|-E|同バージョンがすでにインストールされていれば、インストールを行わない|
|-G|新バージョンが既にインストールされていればインストールを行わない|
|-R|ディレクトリを再帰的に処理|

- `dpkg-reconfigure <パッケージ>` : インストール済みのパッケージを再設定する

|アクション|説明|         
|:-----------|:------------|
| -i (--install) パッケージファイル名|パッケージのインストール|
|-r (--remove) パッケージ名|設定ファイルを残してパッケージをアンインストール|
|-P (--purge) パッケージ名|設定ファイルも含め完全にパッケージをアンインストール|
|-l (--list) [検索パターン]|インストール済みパッケージを検索して表示|
|-L (--listfiles) パッケージ名|指定したパッケージからインストールされたファイルを一覧表示|
|-s (--status) パッケージ名|インストール済みパッケージの詳細情報の表示|
|-S (--search) 検索パターン|指定したファイルがどのパッケージからインストールされたかを表示|
|-C (--audit)|インストールが中断しているパッケージの表示|

- (ex)
 - `apt-get remove apache2`

**rpmコマンドの参照、オプションなど**

|オプション|説明|         
|:-----------|:------------|
|-q (--query) パッケージ名|指定したパッケージがインストールされているか照会|
|-V (--verify) パッケージ名|パッケージの検査(併用オプションは「-a(--all)と「--nomd5」のみ」)|
|-i (--install) パッケージファイル名|パッケージのインストール|
|-U (--upgrade) パッケージ名|パッケージのアップグレード(なければインストールする)|
|-F (--freshen) パッケージ名|パッケージのアップグレード(なければインストールしない)|
|-e (--erase) パッケージ名|パッケージのアンインストール|
|併用オプション　-v|詳細情報の表示|
|併用オプション　-h (--hash)|進行状況を#で表示|
|併用オプション　--test|実際には実行せずにテストを実施|
|併用オプション　--nodeps|依存関係を無視|

**[併用オプション]**

|オプション|説明|         
|:-----------|:------------|
|-a (--all)|インストール済みの全パッケージの表示|
|-l (--list)|指定したパッケージに含まれるファイルの表示|
|-i (--info)|指定したパッケージの詳細情報の表示|
|-f (--file) ファイル名|指定したファイルがどのパッケージからインストールされたかを表示|
|-p (--package)|照会対象をパッケージファイルとする|
|--changelog|指定したパッケージの変更履歴の表示|
|-c (--configfiles)|設定ファイルの一覧表示|
|--nomd5|MD5によるファイルの改ざんを検査しない|

**yum -y [subコマンド]**

|オプション|説明|         
|:-----------|:------------|
|install パッケージ名|パッケージのインストール|
|update パッケージ名|パッケージのアップデート|
|remove パッケージ名|パッケージのアンインストール|
|info パッケージ名|パッケージの詳細情報の表示|
|list パッケージ名|パッケージの一覧表示(バージョンとインストール済かどうか)|
|search キーワード|指定したキーワードでパッケージの検索|
|check-update パッケージ名|アップデート可能なパッケージの表示|
|grouplist|パッケージグループの一覧表示|
|groupinstall グループ|パッケージグループのインストール|

